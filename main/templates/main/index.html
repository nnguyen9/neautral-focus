{% load staticfiles %}
<html lang="en">
    <head>
      <title>{% block title %}Neutral Focus{% endblock %}</title>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
      <script src="//cdnjs.cloudflare.com/ajax/libs/three.js/r70/three.min.js"></script>
      {% block css %}    
        <link href="{% static 'css/style.css' %}" rel="stylesheet" type="text/css">
      {% endblock %}
      {% block js %}
        <!-- WebGazer.js library -->
        <script src="{% static 'js/webgazer.js' %}" type="text/javascript"></script>
        <script src="{% static 'js/script.js' %}" type="text/javascript"></script>
      {% endblock %}
    </head>

    <body>
		
	  <script>
		$(document).ready(function() {
			
			var $pred = $('#prediction-button');

			// Here is where we put to run after the document has loaded

			var canvas = document.getElementById('myCanvas');
			var ctx = canvas.getContext('2d');
			var img = new Image();

			// Loads the initial image
			loadImage = function(src){

				img.crossOrigin = '';
				img.src = src;

				img.onload = function() {
					canvas.width = img.width;
					canvas.height = img.height;
					ctx.drawImage(img, 0, 0, img.width, img.height);
				}
			}
			
			loadImage("{% static 'images/foo.png' %}");
			
			combine_images = function(e, image = "foo.png", mask = "mask.png") {
				
				$.ajax({
					type: "POST",
					url: "{% url 'combine_images' %}",
					data:{
						csrfmiddlewaretoken: '{{ csrf_token }}',
						'image_file': image,
						'mask_file': mask,
					},
					success: function(data) {
						loadImage("{% static 'images/iterable2.png' %}");
					}
				});
			}

			// HERE IS WHERE THE IMAGE SAVE IS CALLED WHEN THE BUTTON IS CLICKED
			$('#save-image-button').click(combine_images)
		});	
		
	  </script>
      
      <button id="prediction-button" type="button">Get Prediction</button>

      <button id="save-image-button" type="button">Save Image</button>

      <canvas id="myCanvas"></canvas>
		
    </body>

</html>
